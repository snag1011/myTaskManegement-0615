<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™‚é–“ç®¡ç†ï¼†é›†ä¸­åŠ›å‘ä¸Šãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header,
        .data-management {
            grid-column: 1 / -1;
            text-align: center;
        }
        .header {
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4);
            color: white;
            margin-bottom: 0;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .section-title {
            color: #333;
            font-size: 1.5em;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            text-align: left;
        }

        .priority-matrix {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .matrix-quadrant {
            min-height: 120px;
            border-radius: 10px;
            padding: 15px;
            position: relative;
            transition: transform 0.2s;
            text-align: left;
        }

        .matrix-quadrant:hover {
            transform: translateY(-2px);
        }

        .urgent-important {
            background: linear-gradient(135deg, #ff4757, #ff3838);
            color: white;
        }

        .important-not-urgent {
            background: linear-gradient(135deg, #2ed573, #1dd1a1);
            color: white;
        }

        .urgent-not-important {
            background: linear-gradient(135deg, #ffa502, #ff9500);
            color: white;
        }

        .not-urgent-not-important {
            background: linear-gradient(135deg, #747d8c, #57606f);
            color: white;
        }

        .quadrant-title {
            font-weight: bold;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .task-input {
            width: 100%;
            padding: 8px;
            border: none;
            border-radius: 5px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .task-input::placeholder {
            color: rgba(255, 255, 255, 0.8);
        }

        .task-list {
            list-style: none;
            margin-top: 10px;
        }

        .task-item {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px;
            margin: 5px 0;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9em;
        }

        .delete-btn {
            background: rgba(255, 255, 255, 0.3);
            border: none;
            color: white;
            padding: 2px 8px;
            border-radius: 3px;
            cursor: pointer;
        }

        .pomodoro-timer {
            text-align: center;
        }

        .timer-display {
            font-size: 4em;
            font-weight: bold;
            color: #333;
            margin: 20px 0;
        }

        .timer-controls {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .btn-secondary {
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
        }

        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
         .btn-warning {
            background: linear-gradient(45deg, #f0ad4e, #ec971f);
            color: white;
        }
        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        /* â˜…è¿½åŠ : ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .btn-success {
            background: linear-gradient(45deg, #2ed573, #1dd1a1);
            color: white;
        }
        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .btn-info {
            background: linear-gradient(45deg, #5bc0de, #31b0d5);
            color: white;
        }
        .btn-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }


        .focus-mode {
            text-align: center;
        }

        .focus-status {
            font-size: 1.2em;
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            background: linear-gradient(45deg, #4ecdc4, #44a08d);
            color: white;
        }

        .daily-goals {
            margin-top: 20px;
            text-align: left;
        }

        .goal-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            margin-bottom: 10px;
            font-size: 1em;
        }

        .goal-list {
            list-style: none;
        }

        .goal-item {
            background: #f8f9fa;
            padding: 12px;
            margin: 8px 0;
            border-radius: 8px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-left: 4px solid #667eea;
        }

        .goal-item.completed {
            background: #d4edda;
            text-decoration: line-through;
            opacity: 0.7;
            border-left-color: #28a745;
        }

        .checkbox {
            margin-right: 10px;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e9ecef;
            border-radius: 5px;
            margin: 15px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, #667eea, #764ba2);
            transition: width 0.3s;
        }

        .time-select,
        input[type="date"].time-select {
            padding: 8px 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 1em;
            background: white;
            cursor: pointer;
            transition: border-color 0.3s;
            color: #333;
        }

        .time-select:focus,
        input[type="date"].time-select:focus {
            outline: none;
            border-color: #667eea;
        }

        .time-select:hover,
        input[type="date"].time-select:hover {
            border-color: #667eea;
        }

        .data-management-controls {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 20px;
            text-align: left;
        }
        .data-management-controls > div {
            display: flex;
            align-items: center;
            gap: 10px;
        }
         .data-management-controls label {
            font-weight: bold;
            color: #333;
        }
        .data-management .section-title {
            justify-content: center;
        }

        /* è¦–è¦šçš„é€šçŸ¥ç”¨ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #visual-notification {
            display: none; /* åˆæœŸçŠ¶æ…‹ã¯éè¡¨ç¤º */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.75);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }

        #visual-notification-content {
            background: linear-gradient(135deg, #ff7e5f, #feb47b);
            color: white;
            padding: 30px 50px;
            border-radius: 15px;
            text-align: center;
            font-size: 22px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            max-width: 90%;
        }

        #visual-notification-content p {
            margin-bottom: 25px;
            font-weight: bold;
            line-height: 1.5;
        }
        /* â˜…å¤‰æ›´: ãƒœã‚¿ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã¨ãƒœã‚¿ãƒ³ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        #visual-notification-actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap; /* å°ç”»é¢ã§æŠ˜ã‚Šè¿”ã™ */
        }
        #visual-notification-actions button,
        #visual-notification-content button#close-visual-notification { /* é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ã‚‚çµ±ä¸€æ„Ÿã‚’å‡ºã™ */
            padding: 10px 20px; /* å°‘ã—å°ã•ã‚ã«èª¿æ•´ */
            border: none;
            border-radius: 20px;
            /* background-color: rgba(255,255,255,0.8); */ /* å€‹åˆ¥ã®ãƒœã‚¿ãƒ³ã‚¹ã‚¿ã‚¤ãƒ«ã§ä¸Šæ›¸ã */
            color: white; /* ãƒ†ã‚­ã‚¹ãƒˆè‰²ã¯ç™½ã‚’åŸºæœ¬ã« */
            font-size: 15px; /* å°‘ã—å°ã•ã‚ã«èª¿æ•´ */
            cursor: pointer;
            transition: background-color 0.2s, transform 0.2s;
            font-weight: bold;
        }
        /* é–‰ã˜ã‚‹ãƒœã‚¿ãƒ³ã®å€‹åˆ¥ã‚¹ã‚¿ã‚¤ãƒ« */
        #close-visual-notification {
            background: linear-gradient(45deg, #747d8c, #57606f); /* ã‚°ãƒ¬ãƒ¼ç³» */
            margin-top: 15px; /* ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ç¾¤ã¨ã®é–“ã«å°‘ã—ãƒãƒ¼ã‚¸ãƒ³ */
        }
        #close-visual-notification:hover {
            transform: translateY(-1px);
            background: linear-gradient(45deg, #57606f, #4a505a);
        }
        #visual-notification-actions button:hover {
            transform: translateY(-2px);
        }


        .visible {
            display: flex !important;
        }

        @keyframes blink-alarm-bg {
            0%, 100% { background-color: #ff7e5f; }
            50% { background-color: #feb47b; }
        }
        #visual-notification-content.blinking {
             animation: blink-alarm-bg 1s infinite;
        }


        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
            }
            .data-management-controls {
                flex-direction: column;
                align-items: stretch;
            }
            .data-management-controls > div {
                justify-content: center;
            }
            #visual-notification-content {
                font-size: 18px;
                padding: 20px 30px;
            }
            #visual-notification-content p {
                margin-bottom: 20px;
            }
            #visual-notification-actions {
                flex-direction: column; /* ã‚¹ãƒãƒ›ã§ã¯ç¸¦ç©ã¿ */
                gap: 10px;
            }
            #visual-notification-actions button,
            #close-visual-notification {
                width: 100%; /* ãƒœã‚¿ãƒ³å¹…ã‚’åºƒã’ã‚‹ */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="card header">
            <h1>ğŸ¯ æ™‚é–“ç®¡ç†ï¼†é›†ä¸­åŠ›å‘ä¸Šãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</h1>
            <p>ã‚¿ã‚¹ã‚¯å„ªå…ˆé †ä½ä»˜ã‘ + ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯</p>
        </div>

        <div class="card data-management">
            <h2 class="section-title">âš™ï¸ ãƒ‡ãƒ¼ã‚¿ç®¡ç†</h2>
            <div class="data-management-controls">
                <div>
                    <label for="work-date">ä½œæ¥­æ—¥:</label>
                    <input type="date" id="work-date" class="time-select">
                </div>
                <div>
                    <button class="btn btn-primary" id="export-csv-btn">å®Ÿç¸¾ã‚’CSVã§å‡ºåŠ›</button>
                    <button class="btn btn-warning" id="reset-all-btn" style="margin-left: 10px;">å…¨ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ</button>
                </div>
            </div>
        </div>

        <div class="card">
            <h2 class="section-title">ğŸ“Š ã‚¢ã‚¤ã‚¼ãƒ³ãƒãƒ¯ãƒ¼ãƒãƒˆãƒªãƒƒã‚¯ã‚¹</h2>
            <div class="priority-matrix">
                <div class="matrix-quadrant urgent-important">
                    <div class="quadrant-title">ğŸ”¥ ç·Šæ€¥ & é‡è¦</div>
                    <input type="text" class="task-input" placeholder="ä»Šã™ãã‚„ã‚‹ã¹ãã‚¿ã‚¹ã‚¯" data-quadrant="urgent-important">
                    <ul class="task-list" id="urgent-important-list"></ul>
                </div>

                <div class="matrix-quadrant important-not-urgent">
                    <div class="quadrant-title">â­ é‡è¦ & éç·Šæ€¥</div>
                    <input type="text" class="task-input" placeholder="è¨ˆç”»çš„ã«å–ã‚Šçµ„ã‚€ã‚¿ã‚¹ã‚¯" data-quadrant="important-not-urgent">
                    <ul class="task-list" id="important-not-urgent-list"></ul>
                </div>

                <div class="matrix-quadrant urgent-not-important">
                    <div class="quadrant-title">âš¡ ç·Šæ€¥ & éé‡è¦</div>
                    <input type="text" class="task-input" placeholder="å§”è­²ã§ãã‚‹ã‚¿ã‚¹ã‚¯" data-quadrant="urgent-not-important">
                    <ul class="task-list" id="urgent-not-important-list"></ul>
                </div>

                <div class="matrix-quadrant not-urgent-not-important">
                    <div class="quadrant-title">âŒ éç·Šæ€¥ & éé‡è¦</div>
                    <input type="text" class="task-input" placeholder="å‰Šé™¤ã§ãã‚‹ã‚¿ã‚¹ã‚¯" data-quadrant="not-urgent-not-important">
                    <ul class="task-list" id="not-urgent-not-important-list"></ul>
                </div>
            </div>
        </div>

        <div class="card pomodoro-timer">
            <h2 class="section-title">ğŸ… ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ã‚¿ã‚¤ãƒãƒ¼</h2>
            <div class="timer-settings" style="display: flex; justify-content: center; gap: 15px; margin-bottom: 20px;">
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">ä½œæ¥­æ™‚é–“</label>
                    <select id="work-time-select" class="time-select">
                        <option value="15">15åˆ†</option>
                        <option value="20">20åˆ†</option>
                        <option value="25" selected>25åˆ†</option>
                        <option value="30">30åˆ†</option>
                        <option value="45">45åˆ†</option>
                        <option value="60">60åˆ†</option>
                        <option value="0.1">ãƒ†ã‚¹ãƒˆ(6ç§’)</option>
                    </select>
                </div>
                <div>
                    <label style="display: block; margin-bottom: 5px; font-weight: bold;">ä¼‘æ†©æ™‚é–“</label>
                    <select id="break-time-select" class="time-select">
                        <option value="3">3åˆ†</option>
                        <option value="5" selected>5åˆ†</option>
                        <option value="10">10åˆ†</option>
                        <option value="15">15åˆ†</option>
                        <option value="0.05">ãƒ†ã‚¹ãƒˆ(3ç§’)</option>
                    </select>
                </div>
            </div>
            <div class="timer-display" id="timer-display">25:00</div>
            <div class="timer-controls">
                <button class="btn btn-primary" id="start-btn">é–‹å§‹</button>
                <button class="btn btn-secondary" id="reset-btn">ãƒªã‚»ãƒƒãƒˆ</button>
            </div>
            <div class="focus-mode">
                <div class="focus-status" id="focus-status">é›†ä¸­ã‚»ãƒƒã‚·ãƒ§ãƒ³æº–å‚™å®Œäº†</div>
                <p id="timer-description">25åˆ†é›†ä¸­ â†’ 5åˆ†ä¼‘æ†©ã®ã‚µã‚¤ã‚¯ãƒ«ã§ä½œæ¥­åŠ¹ç‡UPï¼</p>
            </div>
        </div>

        <div class="card">
            <h2 class="section-title">ğŸ¯ ä»Šæ—¥ã®ç›®æ¨™</h2>
            <div class="daily-goals">
                <input type="text" class="goal-input" id="goal-input" placeholder="ä»Šæ—¥é”æˆã—ãŸã„ç›®æ¨™ã‚’å…¥åŠ›">
                <div class="progress-bar">
                    <div class="progress-fill" id="progress-fill" style="width: 0%"></div>
                </div>
                <ul class="goal-list" id="goal-list"></ul>
            </div>
        </div>

        <div class="card">
            <h2 class="section-title">ğŸ’¡ é›†ä¸­åŠ›å‘ä¸Šã®ã‚³ãƒ„</h2>
            <div style="line-height: 1.6;">
                <p><strong>ğŸ  åœ¨å®…å‹¤å‹™æ™‚ï¼š</strong></p>
                <ul style="margin: 10px 0 20px 20px;">
                    <li>ä½œæ¥­å°‚ç”¨ã‚¹ãƒšãƒ¼ã‚¹ã‚’è¨­ã‘ã‚‹</li>
                    <li>å®¶æ—ã«ä½œæ¥­æ™‚é–“ã‚’å…±æœ‰</li>
                    <li>é©åº¦ãªèƒŒæ™¯éŸ³æ¥½ã‚’æ´»ç”¨</li>
                </ul>

                <p><strong>ğŸ¢ ã‚ªãƒ•ã‚£ã‚¹å‹¤å‹™æ™‚ï¼š</strong></p>
                <ul style="margin: 10px 0 20px 20px;">
                    <li>ãƒã‚¤ã‚ºã‚­ãƒ£ãƒ³ã‚»ãƒªãƒ³ã‚°ã‚¤ãƒ¤ãƒ›ãƒ³ä½¿ç”¨</li>
                    <li>ä¼šè­°ã®åˆé–“ã«5åˆ†ä¼‘æ†©</li>
                    <li>åŒåƒšã¨ã®ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³æ™‚é–“ã‚’è¨­å®š</li>
                </ul>

                <p><strong>ğŸŒŸ å…±é€šã®ã‚³ãƒ„ï¼š</strong></p>
                <ul style="margin: 10px 0 20px 20px;">
                    <li>ã‚¹ãƒãƒ›ã‚’åˆ¥ã®å ´æ‰€ã«ç½®ã</li>
                    <li>æ°´åˆ†è£œçµ¦ã‚’å¿˜ã‚Œãšã«</li>
                    <li>1æ™‚é–“ã«1å›ã¯ç«‹ã¡ä¸ŠãŒã‚‹</li>
                </ul>
            </div>
        </div>
    </div>

    <!-- è¦–è¦šçš„é€šçŸ¥ç”¨è¦ç´  -->
    <div id="visual-notification">
        <div id="visual-notification-content">
            <p id="visual-notification-message">æ™‚é–“ã§ã™ï¼</p>
            <!-- â˜…è¿½åŠ : ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ç”¨ã‚³ãƒ³ãƒ†ãƒŠ -->
            <div id="visual-notification-actions">
                <!-- ãƒœã‚¿ãƒ³ã¯JSã§å‹•çš„ã«ç”Ÿæˆãƒ»åˆ¶å¾¡ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ -->
                <button id="complete-task-btn" class="btn btn-success">äºˆå®šé€šã‚Šå®Œäº†ã—ã¦ä¼‘æ†©ã¸</button>
                <button id="extend-task-btn" class="btn btn-info">ä½œæ¥­ã‚’å»¶é•·</button>
            </div>
            <button id="close-visual-notification">é–‰ã˜ã‚‹ (é€šçŸ¥ã®ã¿)</button>
        </div>
    </div>

    <!-- éŸ³å£°é€šçŸ¥ç”¨ -->
    <audio id="notification-sound" preload="auto"></audio>

    <script>
        // ã‚°ãƒ­ãƒ¼ãƒãƒ«å¤‰æ•°
        let timer = null;
        let workTime = 25 * 60; // ç§’å˜ä½
        let breakTime = 5 * 60; // ç§’å˜ä½
        let timeLeft = workTime;
        let isRunning = false;
        let isWorkSession = true;
        let sessionEndTime = null;
        let pomodoroLog = [];

        // â˜…è¿½åŠ : å®Ÿç¸¾è¨˜éŒ²ç”¨å¤‰æ•°
        let initialWorkDurationForLog;    // ç¾åœ¨ã®ä½œæ¥­ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®å½“åˆè¨ˆç”»æ™‚é–“ï¼ˆãƒ­ã‚°ç”¨ï¼‰
        let accumulatedActualWorkDuration = 0; // ç¾åœ¨ã®ä½œæ¥­ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§å®Ÿéš›ã«ä½œæ¥­ã—ãŸç´¯è¨ˆæ™‚é–“ï¼ˆãƒ­ã‚°ç”¨ï¼‰
        let currentTimerSliceDuration = 0;   // ç¾åœ¨å‹•ã„ã¦ã„ã‚‹ã‚¿ã‚¤ãƒãƒ¼åŒºåˆ†ã®æ™‚é–“ï¼ˆä½œæ¥­ã€ä¼‘æ†©ã€ã¾ãŸã¯å»¶é•·åˆ†ï¼‰

        // DOMè¦ç´ ã‚’å–å¾—
        const timerDisplay = document.getElementById('timer-display');
        const startBtn = document.getElementById('start-btn');
        const resetBtn = document.getElementById('reset-btn');
        const focusStatus = document.getElementById('focus-status');
        const workTimeSelect = document.getElementById('work-time-select');
        const breakTimeSelect = document.getElementById('break-time-select');
        const timerDescription = document.getElementById('timer-description');
        const goalInput = document.getElementById('goal-input');
        const goalList = document.getElementById('goal-list');
        const progressFill = document.getElementById('progress-fill');
        const workDateInput = document.getElementById('work-date');
        const exportCsvBtn = document.getElementById('export-csv-btn');
        const resetAllBtn = document.getElementById('reset-all-btn');

        // é€šçŸ¥é–¢é€£ã®DOMè¦ç´ 
        const visualNotificationElement = document.getElementById('visual-notification');
        const visualNotificationMessageElement = document.getElementById('visual-notification-message');
        const closeVisualNotificationButton = document.getElementById('close-visual-notification');
        const notificationSound = document.getElementById('notification-sound');
        // â˜…è¿½åŠ : ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³
        const completeTaskBtn = document.getElementById('complete-task-btn');
        const extendTaskBtn = document.getElementById('extend-task-btn');


        // éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã®è¨­å®š (ãƒ­ãƒ¼ã‚«ãƒ«ã® alarm.mp3 ã‚’æƒ³å®šã€‚é©å®œå¤‰æ›´ã—ã¦ãã ã•ã„)
        //notificationSound.src = 'alarm.mp3'; // ä¾‹: 'sounds/alarm.mp3' ã¾ãŸã¯ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ãªã‚‰ 'alarm.mp3'
        notificationSound.src = 'Assorted_SE12-21.mp3';

        // notificationSound.src = 'https://actions.google.com/sounds/v1/alarms/alarm_clock.ogg';


        // ã‚¢ã‚¤ã‚¼ãƒ³ãƒãƒ¯ãƒ¼ãƒãƒˆãƒªãƒƒã‚¯ã‚¹æ©Ÿèƒ½
        document.addEventListener('DOMContentLoaded', function() {
            const taskInputs = document.querySelectorAll('.task-input');
            taskInputs.forEach(input => {
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter' && this.value.trim()) {
                        addTaskToMatrix(this.value.trim(), this.dataset.quadrant);
                        this.value = '';
                    }
                });
            });
            if (workDateInput) workDateInput.valueAsDate = new Date();
        });

        function addTaskToMatrix(taskText, quadrant) {
            const list = document.getElementById(quadrant + '-list');
            if (!list) return;
            const li = document.createElement('li');
            li.className = 'task-item';
            li.innerHTML = `<span>${taskText}</span><button class="delete-btn" onclick="this.parentElement.remove()">Ã—</button>`;
            list.appendChild(li);
        }

        // æ™‚é–“è¨­å®šã®å¤‰æ›´ã‚’ç›£è¦–
        workTimeSelect.addEventListener('change', function() {
            workTime = parseFloat(this.value) * 60;
            if (isWorkSession && !isRunning) {
                timeLeft = workTime;
                updateDisplay();
            }
            updateDescription();
        });

        breakTimeSelect.addEventListener('change', function() {
            breakTime = parseFloat(this.value) * 60;
            if (!isWorkSession && !isRunning) {
                timeLeft = breakTime;
                updateDisplay();
            }
            updateDescription();
        });

        // --- é€šçŸ¥æ©Ÿèƒ½ ---
        async function requestNotificationPermission() { /* å¤‰æ›´ãªã— */ }
        function showBrowserNotification(title, body) { /* å¤‰æ›´ãªã— */ }
        function playSoundNotification() { /* å¤‰æ›´ãªã— */ }

        // â˜…å¤‰æ›´: è¦–è¦šé€šçŸ¥ã®è¡¨ç¤º/éè¡¨ç¤ºé–¢æ•°
        function showEndOfSessionAlert(message, showActionButtons = true) {
            visualNotificationMessageElement.innerHTML = message;
            const actionButtonsContainer = document.getElementById('visual-notification-actions');
            if (showActionButtons) {
                actionButtonsContainer.style.display = 'flex';
            } else {
                actionButtonsContainer.style.display = 'none'; // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã‚’éš ã™å ´åˆ
            }
            visualNotificationElement.classList.add('visible');
            visualNotificationElement.querySelector('#visual-notification-content').classList.add('blinking');
        }

        function hideVisualNotification() {
            visualNotificationElement.classList.remove('visible');
            visualNotificationElement.querySelector('#visual-notification-content').classList.remove('blinking');
        }
        // --- é€šçŸ¥æ©Ÿèƒ½ã“ã“ã¾ã§ ---


        // ã‚¿ã‚¤ãƒãƒ¼æ©Ÿèƒ½
        function updateTimer() {
            if (sessionEndTime === null) {
                if (timer) clearInterval(timer);
                timer = null;
                return;
            }

            const now = Date.now();
            const remainingMilliseconds = sessionEndTime - now;

            if (remainingMilliseconds <= 0) {
                timeLeft = 0;
                updateDisplay();
                clearInterval(timer);
                timer = null;
                isRunning = false;
                startBtn.textContent = 'é–‹å§‹'; // ã¾ãŸã¯æ¬¡ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³å

                // â˜…å¤‰æ›´: ã‚¿ã‚¤ãƒãƒ¼çµ‚äº†æ™‚ã®å‡¦ç†
                playSoundNotification(); // éŸ³å£°é€šçŸ¥

                if (isWorkSession) {
                    accumulatedActualWorkDuration += currentTimerSliceDuration; // ã“ã®åŒºåˆ†ã®ä½œæ¥­æ™‚é–“ã‚’åŠ ç®—
                    const message = 'ğŸ•’ ä½œæ¥­æ™‚é–“çµ‚äº†ï¼<br>ã©ã†ã—ã¾ã™ã‹ï¼Ÿ';
                    showBrowserNotification("ä½œæ¥­æ™‚é–“çµ‚äº†ï¼", "æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„ã€‚");
                    showEndOfSessionAlert(message, true); // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ä»˜ãã§è¡¨ç¤º
                    // æ¬¡ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¸ã®è‡ªå‹•ç§»è¡Œã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³å¾…ã¡
                } else { // ä¼‘æ†©ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†
                    addPomodoroLog('break', currentTimerSliceDuration, currentTimerSliceDuration, new Date()); // ä¼‘æ†©ã¯è¨ˆç”»é€šã‚Š
                    
                    focusStatus.textContent = 'âœ¨ ä¼‘æ†©å®Œäº†ï¼æ¬¡ã®é›†ä¸­ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®æº–å‚™ã‚’ã—ã¾ã—ã‚‡ã†';
                    focusStatus.style.background = 'linear-gradient(45deg, #667eea, #764ba2)';
                    isWorkSession = true;
                    timeLeft = workTime; // æ¬¡ã®ä½œæ¥­æ™‚é–“
                    currentTimerSliceDuration = workTime; // â˜…è¿½åŠ 
                    initialWorkDurationForLog = workTime; // â˜…è¿½åŠ : æ–°ã—ã„ä½œæ¥­ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®è¨ˆç”»æ™‚é–“
                    accumulatedActualWorkDuration = 0;    // â˜…è¿½åŠ : æ–°ã—ã„ä½œæ¥­ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®å®Ÿç¸¾ãƒªã‚»ãƒƒãƒˆ
                    
                    const message = 'âœ¨ ä¼‘æ†©å®Œäº†ï¼<br>æ¬¡ã®ä½œæ¥­ã‚’å§‹ã‚ã¾ã—ã‚‡ã†ã€‚';
                    showBrowserNotification("ä¼‘æ†©çµ‚äº†ï¼", "æ¬¡ã®ä½œæ¥­ã‚’é–‹å§‹ã§ãã¾ã™ã€‚");
                    showEndOfSessionAlert(message, false); // ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ãªã—ã€é–‰ã˜ã‚‹ã®ã¿
                    // è‡ªå‹•ã§é–‰ã˜ã‚‹ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚»ãƒƒãƒˆã—ã¦ã‚‚è‰¯ã„
                    setTimeout(hideVisualNotification, 5000); // 5ç§’å¾Œã«è‡ªå‹•ã§é–‰ã˜ã‚‹ä¾‹
                    updateDisplay();
                    startBtn.textContent = 'ä½œæ¥­é–‹å§‹';
                }
                sessionEndTime = null;
            } else {
                timeLeft = Math.round(remainingMilliseconds / 1000);
                updateDisplay();
            }
        }

        function updateDisplay() { /* å¤‰æ›´ãªã— */ }
        function updateDescription() { /* å¤‰æ›´ãªã— */ }

        function startTimerInternal() { // â˜…å¤‰æ›´: startBtnã®å‡¦ç†ã‚’ãƒ©ãƒƒãƒ—ã™ã‚‹å†…éƒ¨é–¢æ•°
            isRunning = true;
            sessionEndTime = Date.now() + timeLeft * 1000;
            if(timer) clearInterval(timer);
            timer = setInterval(updateTimer, 1000);
            updateTimer(); // å³æ™‚æ›´æ–°
        }


        function startPomodoroSession() { // â˜…å¤‰æ›´: startBtnã®ã‚¯ãƒªãƒƒã‚¯ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©
            if (!isRunning) {
                requestNotificationPermission().then(granted => {
                    // é€šçŸ¥è¨±å¯çŠ¶æ…‹ã«é–¢ã‚ã‚‰ãšã‚¿ã‚¤ãƒãƒ¼ã¯é–‹å§‹
                    if (notificationSound.src && notificationSound.src !== window.location.href) {
                        notificationSound.load();
                    }

                    if (isWorkSession) {
                        startBtn.textContent = 'ä¸€æ™‚åœæ­¢';
                        focusStatus.textContent = 'ğŸ”¥ é›†ä¸­ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸­ï¼';
                        focusStatus.style.background = 'linear-gradient(45deg, #ff6b6b, #ee5a52)';
                        if (accumulatedActualWorkDuration === 0) { // æ–°è¦ã®ä½œæ¥­ã‚»ãƒƒã‚·ãƒ§ãƒ³ã®å ´åˆ
                            initialWorkDurationForLog = parseFloat(workTimeSelect.value) * 60;
                        }
                        // timeLeft ã¯æ—¢ã«ã‚»ãƒƒãƒˆã•ã‚Œã¦ã„ã‚‹ã‹ã€å»¶é•·æ™‚ã«å†ã‚»ãƒƒãƒˆã•ã‚Œã‚‹
                        currentTimerSliceDuration = timeLeft; // ç¾åœ¨ã®ã‚¿ã‚¤ãƒãƒ¼åŒºåˆ†ã®æ™‚é–“ã‚’ä¿æŒ
                    } else { // ä¼‘æ†©ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹
                        startBtn.textContent = 'ä¸€æ™‚åœæ­¢';
                        focusStatus.textContent = 'â˜• ä¼‘æ†©ä¸­...';
                        focusStatus.style.background = 'linear-gradient(45deg, #4ecdc4, #44a08d)';
                        timeLeft = parseFloat(breakTimeSelect.value) * 60;
                        currentTimerSliceDuration = timeLeft;
                    }
                    hideVisualNotification(); // é–‹å§‹æ™‚ã«é€šçŸ¥ãŒå‡ºã¦ã„ã‚Œã°æ¶ˆã™
                    startTimerInternal();
                });

            } else { // ä¸€æ™‚åœæ­¢å‡¦ç†
                clearInterval(timer);
                timer = null;
                isRunning = false;
                startBtn.textContent = 'å†é–‹';
                focusStatus.textContent = 'â¸ï¸ ã‚¿ã‚¤ãƒãƒ¼ä¸€æ™‚åœæ­¢ä¸­';
                focusStatus.style.background = 'linear-gradient(45deg, #747d8c, #57606f)';
            }
        }

        function resetPomodoroTimer() {
            clearInterval(timer);
            timer = null;
            isRunning = false;
            isWorkSession = true;
            workTime = parseFloat(workTimeSelect.value) * 60; // ãƒªã‚»ãƒƒãƒˆæ™‚ã¯é¸æŠå€¤ã«æˆ»ã™
            breakTime = parseFloat(breakTimeSelect.value) * 60;
            timeLeft = workTime;
            currentTimerSliceDuration = workTime; // â˜…è¿½åŠ 
            accumulatedActualWorkDuration = 0; // â˜…è¿½åŠ 
            initialWorkDurationForLog = workTime; // â˜…è¿½åŠ 
            sessionEndTime = null;
            startBtn.textContent = 'é–‹å§‹';
            focusStatus.textContent = 'é›†ä¸­ã‚»ãƒƒã‚·ãƒ§ãƒ³æº–å‚™å®Œäº†';
            focusStatus.style.background = 'linear-gradient(45deg, #4ecdc4, #44a08d)';
            updateDisplay();
            document.title = "æ™‚é–“ç®¡ç†ï¼†é›†ä¸­åŠ›å‘ä¸Šãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰";
            hideVisualNotification();
        }

        // ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        startBtn.addEventListener('click', startPomodoroSession);
        resetBtn.addEventListener('click', resetPomodoroTimer);
        closeVisualNotificationButton.addEventListener('click', () => {
             hideVisualNotification();
             // ã€Œé–‰ã˜ã‚‹ã€ã ã‘ã®å ´åˆã€æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’ä¿ƒã™ãŸã‚ã«ãƒœã‚¿ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’ã€Œé–‹å§‹ã€ã«æˆ»ã™ãªã©ã—ã¦ã‚‚è‰¯ã„
             if (!isRunning && sessionEndTime === null) { // ã‚¿ã‚¤ãƒãƒ¼ãŒå®Œå…¨ã«åœæ­¢ã—ã¦ã„ã‚‹å ´åˆ
                if (isWorkSession) startBtn.textContent = "ä½œæ¥­é–‹å§‹";
                else startBtn.textContent = "ä¼‘æ†©é–‹å§‹";
             }
        });

        // â˜…è¿½åŠ : ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒœã‚¿ãƒ³ã®ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼
        completeTaskBtn.addEventListener('click', () => {
            if (isWorkSession) {
                // accumulatedActualWorkDuration ã¯æ—¢ã« updateTimer ã®çµ‚äº†æ™‚ã«æ›´æ–°æ¸ˆã¿
                addPomodoroLog('work', initialWorkDurationForLog, accumulatedActualWorkDuration, new Date());
            }
            hideVisualNotification();

            // ä¼‘æ†©ã‚»ãƒƒã‚·ãƒ§ãƒ³ã¸ç§»è¡Œ
            isWorkSession = false;
            timeLeft = parseFloat(breakTimeSelect.value) * 60;
            currentTimerSliceDuration = timeLeft; // â˜…è¿½åŠ 
            updateDisplay();
            focusStatus.textContent = 'â˜• ä¼‘æ†©æ™‚é–“ã®æº–å‚™ãŒã§ãã¾ã—ãŸ';
            focusStatus.style.background = 'linear-gradient(45deg, #4ecdc4, #44a08d)';
            startBtn.textContent = 'ä¼‘æ†©é–‹å§‹';
        });

        extendTaskBtn.addEventListener('click', () => {
            if (isWorkSession) {
                hideVisualNotification();
                // å»¶é•·æ™‚é–“ã¯ç¾åœ¨ã®ä½œæ¥­æ™‚é–“è¨­å®šã¨åŒã˜ã¨ã™ã‚‹
                const extensionDuration = parseFloat(workTimeSelect.value) * 60;
                timeLeft = extensionDuration;
                currentTimerSliceDuration = extensionDuration; // â˜…è¿½åŠ ï¼šå»¶é•·åŒºåˆ†ã®æ™‚é–“ã‚’ã‚»ãƒƒãƒˆ
                
                focusStatus.textContent = 'ğŸ”¥ ä½œæ¥­å»¶é•·ä¸­ï¼';
                startBtn.textContent = 'ä¸€æ™‚åœæ­¢';
                startTimerInternal(); // ã‚¿ã‚¤ãƒãƒ¼ã‚’å†é–‹
            }
        });


        // ä»Šæ—¥ã®ç›®æ¨™æ©Ÿèƒ½ (å¤‰æ›´ãªã—)
        goalInput.addEventListener('keypress', function(e) { /* ... */ });
        function addGoal(goalText) { /* ... */ }
        window.toggleGoalCompletion = function(checkbox) { /* ... */ }
        window.removeGoalItem = function(button) { /* ... */ }
        function updateProgress() { /* ... */ }

        // â˜…å¤‰æ›´: ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ãƒ­ã‚°è¨˜éŒ²æ©Ÿèƒ½
        function addPomodoroLog(type, plannedDurationInSeconds, actualDurationInSeconds, completedAtDate) {
            pomodoroLog.push({
                type: type,
                plannedDuration: plannedDurationInSeconds, // è¨ˆç”»æ™‚é–“ (ç§’)
                actualDuration: actualDurationInSeconds,   // å®Ÿç¸¾æ™‚é–“ (ç§’)
                completedAt: completedAtDate
            });
            // console.log("Log added:", pomodoroLog[pomodoroLog.length -1]); // ãƒ‡ãƒãƒƒã‚°ç”¨
        }

        // å…¨ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆæ©Ÿèƒ½ (å¤‰æ›´ãªã—)
        resetAllBtn.addEventListener('click', function() { /* ... */ });

        // â˜…å¤‰æ›´: CSVå‡ºåŠ›æ©Ÿèƒ½
        exportCsvBtn.addEventListener('click', function() {
            let csvContent = "";
            const selectedDate = workDateInput.value ? new Date(workDateInput.value) : new Date();
            const formattedDate = selectedDate.toLocaleDateString('ja-JP', { year: 'numeric', month: '2-digit', day: '2-digit' }).replace(/\//g, '-');
            csvContent += `æ—¥ä»˜,"${formattedDate}"\n\n`;

            csvContent += "ä»Šæ—¥ã®ç›®æ¨™:\n";
            const goals = goalList.querySelectorAll('.goal-item span');
            if (goals.length > 0) {
                goals.forEach(goal => {
                    csvContent += `"${goal.textContent.replace(/"/g, '""')}"\n`;
                });
            } else {
                csvContent += "(ç›®æ¨™ãªã—)\n";
            }
            csvContent += "\n";

            // CSVãƒ˜ãƒƒãƒ€ãƒ¼ã®å¤‰æ›´
            csvContent += "ç¨®åˆ¥,ã‚¿ã‚¹ã‚¯å,è¨ˆç”»æ™‚é–“(åˆ†),å®Ÿç¸¾æ™‚é–“(åˆ†),ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹,å·®ç•°(åˆ†),å®Œäº†æ™‚åˆ»(HH:MM:SS)\n";

            if (pomodoroLog.length > 0) {
                pomodoroLog.forEach(log => {
                    const typeDisplay = log.type === 'work' ? "ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ä½œæ¥­" : "ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ä¼‘æ†©";
                    const taskName = log.type === 'work' ? "(ä½œæ¥­å†…å®¹ã‚’æ‰‹å…¥åŠ›)" : "-"; // ã‚¿ã‚¹ã‚¯åã¯æ‰‹å…¥åŠ›ã®ã¾ã¾
                    
                    const plannedMinutes = Math.round(log.plannedDuration / 60);
                    const actualMinutes = Math.round(log.actualDuration / 60);
                    const diffMinutes = actualMinutes - plannedMinutes;

                    let status = "";
                    let diffDisplay = "";

                    if (log.type === 'work') { // ä½œæ¥­ãƒ­ã‚°ã®å ´åˆã®ã¿ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã¨å·®ç•°ã‚’è¨ˆç®—
                        if (actualMinutes === plannedMinutes) {
                            status = "è¨ˆç”»é€šã‚Š";
                            diffDisplay = "0";
                        } else if (actualMinutes < plannedMinutes) {
                            status = "è¨ˆç”»å‰å€’ã—";
                            diffDisplay = String(diffMinutes); // ä¾‹: -5 (5åˆ†æ—©ãçµ‚ã‚ã£ãŸ)
                        } else { // actualMinutes > plannedMinutes
                            status = "è¨ˆç”»é…ã‚Œ";
                            diffDisplay = String(diffMinutes); // ä¾‹: 10 (10åˆ†é…ã‚ŒãŸ)
                        }
                    } else { // ä¼‘æ†©ãƒ­ã‚°ã®å ´åˆã¯ç©ºæ¬„
                        status = "-";
                        diffDisplay = "-";
                    }

                    const completedTime = log.completedAt.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit', second: '2-digit' });

                    csvContent += `"${typeDisplay}","${taskName}","${plannedMinutes}","${actualMinutes}","${status}","${diffDisplay}","${completedTime}"\n`;
                });
            } else {
                csvContent += "(å®Ÿç¸¾ãƒ­ã‚°ãªã—)\n";
            }

            const blob = new Blob([new Uint8Array([0xEF, 0xBB, 0xBF]), csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute("href", url);
                link.setAttribute("download", `å®Ÿç¸¾ãƒ‡ãƒ¼ã‚¿_${formattedDate}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } else {
                alert("ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯CSVãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚");
            }
        });

        // åˆæœŸè¨­å®š
        resetPomodoroTimer(); // åˆæœŸåŒ–æ™‚ã«å¤‰æ•°ã‚’æ­£ã—ãã‚»ãƒƒãƒˆã™ã‚‹ãŸã‚ã«resetã‚’å‘¼ã¶
        // updateDisplay(); // resetPomodoroTimerå†…ã§å‘¼ã°ã‚Œã‚‹
        // updateDescription(); // resetPomodoroTimerå†…ã§å‘¼ã°ã‚Œã‚‹
        if (!notificationSound.src || notificationSound.src === window.location.href || notificationSound.src.endsWith('/null') || notificationSound.src === '') {
             console.warn("æ³¨æ„: é€šçŸ¥éŸ³ã®éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ãŒ <audio> ã‚¿ã‚°ã® src å±æ€§ã«è¨­å®šã•ã‚Œã¦ã„ãªã„ã‹ã€JavaScriptã§æ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚`notificationSound.src = 'alarm.mp3';` ã®ã‚ˆã†ãªè¡Œã‚’ç¢ºèªãƒ»ç·¨é›†ã—ã¦ãã ã•ã„ã€‚");
             // alert("è­¦å‘Š: é€šçŸ¥éŸ³ã®éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚");
        }
    </script>
</body>
</html>
